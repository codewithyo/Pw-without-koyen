import base64
exec(base64.b64decode('ZnJvbSBweXJvZ3JhbSBpbXBvcnQgQ2xpZW50LCBmaWx0ZXJzCmZyb20gcHlyb2dyYW0udHlwZXMgaW1wb3J0IE1lc3NhZ2UsIElubGluZUtleWJvYXJkTWFya3VwLCBJbmxpbmVLZXlib2FyZEJ1dHRvbgppbXBvcnQgbG9nZ2luZwppbXBvcnQgb3MKaW1wb3J0IHJlCgojIENvbmZpZ3VyZSBsb2dnaW5nCmxvZ2dpbmcuYmFzaWNDb25maWcobGV2ZWw9bG9nZ2luZy5JTkZPLCBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJykKCmFzeW5jIGRlZiBoYW5kbGVfdGV4dF90b19odG1sKGJvdDogQ2xpZW50LCBjYWxsYmFja19xdWVyeSk6CiAgICAiIiJIYW5kbGUgdGhlIHRleHQgdG8gSFRNTCBjb252ZXJzaW9uIGZsb3ciIiIKICAgIHRyeToKICAgICAgICAjIERlbGV0ZSB0aGUgcHJldmlvdXMgbWVzc2FnZQogICAgICAgIGF3YWl0IGNhbGxiYWNrX3F1ZXJ5Lm1lc3NhZ2UuZGVsZXRlKCkKICAgICAgICAKICAgICAgICAjIFNlbmQgcGxhdGZvcm0gc2VsZWN0aW9uIG1lc3NhZ2UKICAgICAgICBrZXlib2FyZCA9IFsKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCJQaHlzaWNzIFdhbGxhaCIsIGNhbGxiYWNrX2RhdGE9Imh0bWxfcHciKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigiQ2xhc3NQbHVzIiwgY2FsbGJhY2tfZGF0YT0iaHRtbF9jcCIpXSwKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLirIXvuI8gQmFjayIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfcGFnZSIpXQogICAgICAgIF0KICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgICAgICAKICAgICAgICBhd2FpdCBib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICBjaGF0X2lkPWNhbGxiYWNrX3F1ZXJ5Lm1lc3NhZ2UuY2hhdC5pZCwKICAgICAgICAgICAgdGV4dD0iKipTZWxlY3QgUGxhdGZvcm0gZm9yIFRleHQgdG8gSFRNTCBDb252ZXJzaW9uOioqIiwKICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cAogICAgICAgICkKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW4gaGFuZGxlX3RleHRfdG9faHRtbDoge2V9IikKICAgICAgICBhd2FpdCBib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICBjaGF0X2lkPWNhbGxiYWNrX3F1ZXJ5Lm1lc3NhZ2UuY2hhdC5pZCwKICAgICAgICAgICAgdGV4dD1mIioqRXJyb3I6IHtzdHIoZSl9KioiCiAgICAgICAgKQoKYXN5bmMgZGVmIGhhbmRsZV9wbGF0Zm9ybV9zZWxlY3Rpb24oYm90OiBDbGllbnQsIGNhbGxiYWNrX3F1ZXJ5KToKICAgICIiIkhhbmRsZSB0aGUgcGxhdGZvcm0tc3BlY2lmaWMgdGV4dCB0byBIVE1MIGNvbnZlcnNpb24iIiIKICAgIHRyeToKICAgICAgICBwbGF0Zm9ybSA9IGNhbGxiYWNrX3F1ZXJ5LmRhdGEuc3BsaXQoJ18nKVsxXSAgIyBodG1sX3B3IG9yIGh0bWxfY3AKICAgICAgICAKICAgICAgICAjIERlbGV0ZSB0aGUgcGxhdGZvcm0gc2VsZWN0aW9uIG1lc3NhZ2UKICAgICAgICBhd2FpdCBjYWxsYmFja19xdWVyeS5tZXNzYWdlLmRlbGV0ZSgpCiAgICAgICAgCiAgICAgICAgIyBTZW5kIGluc3RydWN0aW9uIG1lc3NhZ2UgYmFzZWQgb24gcGxhdGZvcm0KICAgICAgICBpZiBwbGF0Zm9ybSA9PSAicHciOgogICAgICAgICAgICBwbGF0Zm9ybV9uYW1lID0gIlBoeXNpY3MgV2FsbGFoIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBsYXRmb3JtX25hbWUgPSAiQ2xhc3NQbHVzIgogICAgICAgICAgICAKICAgICAgICBtc2cgPSBhd2FpdCBib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICBjaGF0X2lkPWNhbGxiYWNrX3F1ZXJ5Lm1lc3NhZ2UuY2hhdC5pZCwKICAgICAgICAgICAgdGV4dD1mIioqU2VuZCB5b3VyIHtwbGF0Zm9ybV9uYW1lfSB0ZXh0IGZpbGUgdG8gY29udmVydCB0byBIVE1MLioqIgogICAgICAgICkKICAgICAgICAKICAgICAgICByZXR1cm4gbXNnLCBwbGF0Zm9ybQogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBpbiBoYW5kbGVfcGxhdGZvcm1fc2VsZWN0aW9uOiB7ZX0iKQogICAgICAgIGF3YWl0IGJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgIGNoYXRfaWQ9Y2FsbGJhY2tfcXVlcnkubWVzc2FnZS5jaGF0LmlkLAogICAgICAgICAgICB0ZXh0PWYiKipFcnJvcjoge3N0cihlKX0qKiIKICAgICAgICApCgpkZWYgcHJvY2Vzc19jcF90ZXh0X2NvbnRlbnQodGV4dF9jb250ZW50OiBzdHIpIC0+IHR1cGxlW2xpc3QsIHN0cl06CiAgICAiIiJQcm9jZXNzIENsYXNzUGx1cyB0ZXh0IGNvbnRlbnQgYW5kIGV4dHJhY3QgVVJMcyIiIgogICAgdHJ5OgogICAgICAgICMgU3BsaXQgdGhlIHRleHQgaW50byBsaW5lcyBhbmQgZmlsdGVyIG91dCBlbXB0eSBsaW5lcwogICAgICAgIGxpbmVzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiB0ZXh0X2NvbnRlbnQuc3BsaXQoJ1xuJykgaWYgbGluZS5zdHJpcCgpXQogICAgICAgIAogICAgICAgICMgRXh0cmFjdCB0aXRsZTp1cmwgcGFpcnMKICAgICAgICBjb250ZW50X3BhaXJzID0gW10KICAgICAgICB2aWRlb19jb3VudCA9IDAKICAgICAgICBwZGZfY291bnQgPSAwCiAgICAgICAgCiAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6CiAgICAgICAgICAgIGlmICc6JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgdGl0bGUsIHVybCA9IGxpbmUuc3BsaXQoJzonLCAxKQogICAgICAgICAgICAgICAgdGl0bGUgPSB0aXRsZS5zdHJpcCgpCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwuc3RyaXAoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIFVSTCBpcyB2YWxpZCBDbGFzc1BsdXMgVVJMCiAgICAgICAgICAgICAgICBpZiB1cmwgYW5kICgnY2xhc3NwbHVzJyBpbiB1cmwubG93ZXIoKSBvciAnY2xhc3NwbHVzYXBwJyBpbiB1cmwubG93ZXIoKSk6CiAgICAgICAgICAgICAgICAgICAgIyBEZXRlcm1pbmUgY29udGVudCB0eXBlCiAgICAgICAgICAgICAgICAgICAgaWYgdXJsLmxvd2VyKCkuZW5kc3dpdGgoJy5tM3U4Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgY2FyZF90eXBlID0gJ3ZpZGVvLWNhcmQnCiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gPSAn4pa2JwogICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrID0gZidwbGF5VmlkZW8oInt1cmx9IiknCiAgICAgICAgICAgICAgICAgICAgZWxpZiB1cmwubG93ZXIoKS5lbmRzd2l0aCgnLnBkZicpOgogICAgICAgICAgICAgICAgICAgICAgICBwZGZfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBjYXJkX3R5cGUgPSAncGRmLWNhcmQnCiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gPSAn8J+ThCcKICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljayA9IGYnd2luZG93Lm9wZW4oImh0dHBzOi8vZG9jcy5nb29nbGUuY29tL3ZpZXdlcj91cmw9e3VybH0iLCAiX2JsYW5rIiknCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgICMgU2tpcCBpbnZhbGlkIFVSTHMKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29udGVudF9wYWlycy5hcHBlbmQoKHRpdGxlLCB1cmwsIGNhcmRfdHlwZSwgaWNvbiwgb25jbGljaykpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGNvbnRlbnRfcGFpcnM6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiTm8gdmFsaWQgQ2xhc3NQbHVzIFVSTHMgZm91bmQgaW4gdGhlIHRleHQgZmlsZSIpCiAgICAgICAgCiAgICAgICAgIyBHZW5lcmF0ZSBIVE1MIGNvbnRlbnQgdXNpbmcgdGhlIHRlbXBsYXRlCiAgICAgICAgd2l0aCBvcGVuKCd0MmhfY3AuaHRtbCcsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgdGVtcGxhdGUgPSBmLnJlYWQoKQogICAgICAgICAgICAKICAgICAgICAjIEdlbmVyYXRlIHRib2R5IGNvbnRlbnQKICAgICAgICB0Ym9keV9jb250ZW50ID0gW10KICAgICAgICBmb3IgdGl0bGUsIHVybCwgY2FyZF90eXBlLCBpY29uLCBvbmNsaWNrIGluIGNvbnRlbnRfcGFpcnM6CiAgICAgICAgICAgIGNhcmRfaHRtbCA9IGYnJycKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtY2FyZCB7Y2FyZF90eXBlfSI+CiAgICAgICAgICAgICAgICAgICAgPGE+e3RpdGxlfTwvYT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwbGF5LWJ1dHRvbiIgb25jbGljaz0ne29uY2xpY2t9Jz57aWNvbn08L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PicnJwogICAgICAgICAgICB0Ym9keV9jb250ZW50LmFwcGVuZChjYXJkX2h0bWwpCiAgICAgICAgICAgIAogICAgICAgICMgUmVwbGFjZSBwbGFjZWhvbGRlcnMgaW4gdGVtcGxhdGUKICAgICAgICBodG1sX2NvbnRlbnQgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd0Ym9keV9jb250ZW50JywgJ1xuJy5qb2luKHRib2R5X2NvbnRlbnQpKQogICAgICAgIGh0bWxfY29udGVudCA9IGh0bWxfY29udGVudC5yZXBsYWNlKCdiYXRjaF9uYW1lJywgZidDbGFzc1BsdXMgQ291cnNlIENvbnRlbnQgKPCfjqwgVmlkZW9zOiB7dmlkZW9fY291bnR9IHwg8J+ThCBQREZzOiB7cGRmX2NvdW50fSknKQogICAgICAgIAogICAgICAgIHJldHVybiBjb250ZW50X3BhaXJzLCBodG1sX2NvbnRlbnQsIHZpZGVvX2NvdW50LCBwZGZfY291bnQKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgcHJvY2Vzc2luZyBDUCB0ZXh0IGNvbnRlbnQ6IHtlfSIpCiAgICAgICAgcmFpc2UKCmRlZiBleHRyYWN0X3ZpZGVvX2lkKHVybCk6CiAgICAiIiJFeHRyYWN0IHZpZGVvIElEIGZyb20gUFcgVVJMIGNvbnRhaW5pbmcgL21hc3Rlci5tcGQiIiIKICAgIGlmICcvbWFzdGVyLm1wZCcgaW4gdXJsOgogICAgICAgIHBhcnRzID0gdXJsLnNwbGl0KCcvJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIGluZGV4ID0gcGFydHMuaW5kZXgoJ21hc3Rlci5tcGQnKQogICAgICAgICAgICBpZiBpbmRleCA+IDA6CiAgICAgICAgICAgICAgICByZXR1cm4gcGFydHNbaW5kZXggLSAxXQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICByZXR1cm4gTm9uZQoKZGVmIGNsZWFuX3VybCh1cmwpOgogICAgIiIiQ2xlYW4gYW5kIGV4dHJhY3QgcHJvcGVyIFVSTCBmcm9tIHBvdGVudGlhbGx5IG1hbGZvcm1lZCBzdHJpbmciIiIKICAgICMgSWYgdGhlIFVSTCBjb250YWlucyBhIHRpdGxlIHByZWZpeCwgcmVtb3ZlIGl0CiAgICBpZiAnOmh0dHBzOi8vJyBpbiB1cmw6CiAgICAgICAgdXJsID0gJ2h0dHBzOi8vJyArIHVybC5zcGxpdCgnOmh0dHBzOi8vJylbLTFdCiAgICByZXR1cm4gdXJsLnN0cmlwKCkKCmRlZiBwcm9jZXNzX3B3X3RleHRfY29udGVudCh0ZXh0X2NvbnRlbnQ6IHN0cikgLT4gdHVwbGVbbGlzdCwgc3RyXToKICAgICIiIlByb2Nlc3MgUGh5c2ljcyBXYWxsYWggdGV4dCBjb250ZW50IGFuZCBleHRyYWN0IFVSTHMiIiIKICAgIHRyeToKICAgICAgICAjIFNwbGl0IHRoZSB0ZXh0IGludG8gbGluZXMgYW5kIGZpbHRlciBvdXQgZW1wdHkgbGluZXMKICAgICAgICBsaW5lcyA9IFtsaW5lLnN0cmlwKCkgZm9yIGxpbmUgaW4gdGV4dF9jb250ZW50LnNwbGl0KCdcbicpIGlmIGxpbmUuc3RyaXAoKV0KICAgICAgICAKICAgICAgICAjIEV4dHJhY3QgdGl0bGU6dXJsIHBhaXJzCiAgICAgICAgY29udGVudF9wYWlycyA9IFtdCiAgICAgICAgdmlkZW9fY291bnQgPSAwCiAgICAgICAgcGRmX2NvdW50ID0gMAogICAgICAgIAogICAgICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgICAgICBpZiAnOicgaW4gbGluZToKICAgICAgICAgICAgICAgIHRpdGxlLCB1cmwgPSBsaW5lLnNwbGl0KCc6JywgMSkKICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGUuc3RyaXAoKQogICAgICAgICAgICAgICAgdXJsID0gY2xlYW5fdXJsKHVybCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDaGVjayBpZiBVUkwgaXMgdmFsaWQKICAgICAgICAgICAgICAgIGlmIHVybDoKICAgICAgICAgICAgICAgICAgICAjIEhhbmRsZSBNUEQgVVJMcwogICAgICAgICAgICAgICAgICAgIGlmIHVybC5sb3dlcigpLmVuZHN3aXRoKCcubXBkJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgY2FyZF90eXBlID0gJ3ZpZGVvLWNhcmQnCiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gPSAn4pa2JwogICAgICAgICAgICAgICAgICAgICAgICB2aWRlb19pZCA9IGV4dHJhY3RfdmlkZW9faWQodXJsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2aWRlb19pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl91cmwgPSBmJ2h0dHBzOi8vcGxheWVyLm11ZnR1a21hbGwuc2l0ZS8/aWQ9e3ZpZGVvX2lkfScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2sgPSBmJ3BsYXlWaWRlbygie3BsYXllcl91cmx9IiknCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrID0gZidwbGF5VmlkZW8oInt1cmx9IiknCiAgICAgICAgICAgICAgICAgICAgIyBIYW5kbGUgUERGIFVSTHMKICAgICAgICAgICAgICAgICAgICBlbGlmIHVybC5sb3dlcigpLmVuZHN3aXRoKCcucGRmJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHBkZl9jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmRfdHlwZSA9ICdwZGYtY2FyZCcKICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiA9ICfwn5OEJwogICAgICAgICAgICAgICAgICAgICAgICAjIFVzZSBHb29nbGUgRG9jcyB2aWV3ZXIgZm9yIFBERnMKICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlX2RvY3NfdXJsID0gZidodHRwczovL2RvY3MuZ29vZ2xlLmNvbS92aWV3ZXI/dXJsPXt1cmx9JmVtYmVkZGVkPXRydWUnCiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2sgPSBmJ3dpbmRvdy5vcGVuKCJ7Z29vZ2xlX2RvY3NfdXJsfSIsICJfYmxhbmsiKScKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSAgIyBTa2lwIGludmFsaWQgVVJMcwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb250ZW50X3BhaXJzLmFwcGVuZCgodGl0bGUsIHVybCwgY2FyZF90eXBlLCBpY29uLCBvbmNsaWNrKSkKICAgICAgICAKICAgICAgICBpZiBub3QgY29udGVudF9wYWlyczoKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJObyB2YWxpZCBQaHlzaWNzIFdhbGxhaCBVUkxzIGZvdW5kIGluIHRoZSB0ZXh0IGZpbGUiKQogICAgICAgIAogICAgICAgICMgR2VuZXJhdGUgSFRNTCBjb250ZW50IHVzaW5nIHRoZSB0ZW1wbGF0ZQogICAgICAgIHdpdGggb3BlbigndDJoX3B3Lmh0bWwnLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgIHRlbXBsYXRlID0gZi5yZWFkKCkKICAgICAgICAgICAgCiAgICAgICAgIyBHZW5lcmF0ZSB0Ym9keSBjb250ZW50CiAgICAgICAgdGJvZHlfY29udGVudCA9IFtdCiAgICAgICAgZm9yIHRpdGxlLCB1cmwsIGNhcmRfdHlwZSwgaWNvbiwgb25jbGljayBpbiBjb250ZW50X3BhaXJzOgogICAgICAgICAgICBjYXJkX2h0bWwgPSBmJycnCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LWNhcmQge2NhcmRfdHlwZX0iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtaWNvbiI+e2ljb259PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGE+e3RpdGxlfTwvYT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwbGF5LWJ1dHRvbiIgb25jbGljaz0ne29uY2xpY2t9Jz57aWNvbn08L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PicnJwogICAgICAgICAgICB0Ym9keV9jb250ZW50LmFwcGVuZChjYXJkX2h0bWwpCiAgICAgICAgICAgIAogICAgICAgICMgUmVwbGFjZSBwbGFjZWhvbGRlcnMgaW4gdGVtcGxhdGUKICAgICAgICBodG1sX2NvbnRlbnQgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd0Ym9keV9jb250ZW50JywgJ1xuJy5qb2luKHRib2R5X2NvbnRlbnQpKQogICAgICAgIGh0bWxfY29udGVudCA9IGh0bWxfY29udGVudC5yZXBsYWNlKCdiYXRjaF9uYW1lJywgZidQaHlzaWNzIFdhbGxhaCBDb3Vyc2UgQ29udGVudCAo8J+OrCBWaWRlb3M6IHt2aWRlb19jb3VudH0gfCDwn5OEIFBERnM6IHtwZGZfY291bnR9KScpCiAgICAgICAgCiAgICAgICAgIyBBZGQgSmF2YVNjcmlwdCBmdW5jdGlvbnMgZm9yIHZpZGVvIHBsYXliYWNrCiAgICAgICAgdmlkZW9fcGxheWVyX2pzID0gJycnCiAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgZnVuY3Rpb24gcGxheVZpZGVvKHVybCkgewogICAgICAgICAgICAgICAgY29uc3QgcGxheWVyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllckNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3QgdmlkZW9QbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW9QbGF5ZXInKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2V0IHVwIHRoZSB2aWRlbyBwbGF5ZXIKICAgICAgICAgICAgICAgIHZpZGVvUGxheWVyLnNyYyA9IHVybDsKICAgICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGZ1bGxzY3JlZW4gb24gbW9iaWxlCiAgICAgICAgICAgICAgICBpZiAod2luZG93Lm1hdGNoTWVkaWEoIihtYXgtd2lkdGg6IDc2OHB4KSIpLm1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlkZW9QbGF5ZXIucmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvUGxheWVyLnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmlkZW9QbGF5ZXIud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvUGxheWVyLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmlkZW9QbGF5ZXIubW96UmVxdWVzdEZ1bGxTY3JlZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvUGxheWVyLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmlkZW9QbGF5ZXIubXNSZXF1ZXN0RnVsbHNjcmVlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9QbGF5ZXIubXNSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGdWxsc2NyZWVuIHJlcXVlc3QgZmFpbGVkOicsIGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VQbGF5ZXIoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyQ29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBjb25zdCB2aWRlb1BsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlb1BsYXllcicpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aGUgdmlkZW8gc291cmNlCiAgICAgICAgICAgICAgICB2aWRlb1BsYXllci5zcmMgPSAnJzsKICAgICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRXhpdCBmdWxsc2NyZWVuIGlmIG5lZWRlZAogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4pIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbigpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgPC9zY3JpcHQ+CiAgICAgICAgJycnCiAgICAgICAgCiAgICAgICAgIyBJbnNlcnQgdGhlIEphdmFTY3JpcHQgYmVmb3JlIHRoZSBjbG9zaW5nIDwvYm9keT4gdGFnCiAgICAgICAgaHRtbF9jb250ZW50ID0gaHRtbF9jb250ZW50LnJlcGxhY2UoJzwvYm9keT4nLCBmJ3t2aWRlb19wbGF5ZXJfanN9XG48L2JvZHk+JykKICAgICAgICAKICAgICAgICByZXR1cm4gY29udGVudF9wYWlycywgaHRtbF9jb250ZW50LCB2aWRlb19jb3VudCwgcGRmX2NvdW50CiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHByb2Nlc3NpbmcgUFcgdGV4dCBjb250ZW50OiB7ZX0iKQogICAgICAgIHJhaXNlCgphc3luYyBkZWYgcHJvY2Vzc190ZXh0X2NvbnRlbnQoYm90OiBDbGllbnQsIG1lc3NhZ2U6IE1lc3NhZ2UsIHBsYXRmb3JtOiBzdHIpOgogICAgIiIiUHJvY2VzcyB0aGUgdGV4dCBjb250ZW50IGFuZCBjb252ZXJ0IGl0IHRvIEhUTUwiIiIKICAgIHRyeToKICAgICAgICAjIENoZWNrIGlmIGEgZmlsZSB3YXMgc2VudAogICAgICAgIGlmIG5vdCBtZXNzYWdlLmRvY3VtZW50OgogICAgICAgICAgICBhd2FpdCBtZXNzYWdlLnJlcGx5X3RleHQoIioqUGxlYXNlIHNlbmQgYSB0ZXh0IGZpbGUuKioiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgIyBHZXQgb3JpZ2luYWwgZmlsZW5hbWUgd2l0aG91dCBleHRlbnNpb24KICAgICAgICBvcmlnaW5hbF9maWxlbmFtZSA9IG9zLnBhdGguc3BsaXRleHQobWVzc2FnZS5kb2N1bWVudC5maWxlX25hbWUpWzBdCiAgICAgICAgICAgIAogICAgICAgICMgRG93bmxvYWQgdGhlIGZpbGUKICAgICAgICBmaWxlX3BhdGggPSBhd2FpdCBtZXNzYWdlLmRvd25sb2FkKCkKICAgICAgICAKICAgICAgICAjIFJlYWQgZmlsZSBjb250ZW50CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICB0ZXh0X2NvbnRlbnQgPSBmLnJlYWQoKQogICAgICAgICAgICAKICAgICAgICAjIFByb2Nlc3MgYmFzZWQgb24gcGxhdGZvcm0KICAgICAgICBpZiBwbGF0Zm9ybSA9PSAiY3AiOgogICAgICAgICAgICAjIFByb2Nlc3MgQ2xhc3NQbHVzIGNvbnRlbnQKICAgICAgICAgICAgY29udGVudF9wYWlycywgaHRtbF9jb250ZW50LCB2aWRlb19jb3VudCwgcGRmX2NvdW50ID0gcHJvY2Vzc19jcF90ZXh0X2NvbnRlbnQodGV4dF9jb250ZW50KQogICAgICAgICAgICBwbGF0Zm9ybV9uYW1lID0gIkNsYXNzUGx1cyIKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIFByb2Nlc3MgUGh5c2ljcyBXYWxsYWggY29udGVudAogICAgICAgICAgICBjb250ZW50X3BhaXJzLCBodG1sX2NvbnRlbnQsIHZpZGVvX2NvdW50LCBwZGZfY291bnQgPSBwcm9jZXNzX3B3X3RleHRfY29udGVudCh0ZXh0X2NvbnRlbnQpCiAgICAgICAgICAgIHBsYXRmb3JtX25hbWUgPSAiUGh5c2ljcyBXYWxsYWgiCiAgICAgICAgICAgIAogICAgICAgICMgQ3JlYXRlIEhUTUwgZmlsZSB3aXRoIHNhbWUgbmFtZSBhcyBpbnB1dCBmaWxlCiAgICAgICAgb3V0cHV0X2ZpbGUgPSBmIntvcmlnaW5hbF9maWxlbmFtZX0uaHRtbCIKICAgICAgICB3aXRoIG9wZW4ob3V0cHV0X2ZpbGUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShodG1sX2NvbnRlbnQpCiAgICAgICAgICAgIAogICAgICAgICMgU2VuZCByZXNwb25zZSB3aXRoIFVSTCBjb3VudAogICAgICAgIHRvdGFsX2NvdW50ID0gbGVuKGNvbnRlbnRfcGFpcnMpCiAgICAgICAgYXdhaXQgbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICBmIioqRm91bmQge3RvdGFsX2NvdW50fSB7cGxhdGZvcm1fbmFtZX0gVVJMczoqKlxuIgogICAgICAgICAgICBmIioq8J+OrCBWaWRlb3M6IHt2aWRlb19jb3VudH1cbiIKICAgICAgICAgICAgZiLwn5OEIFBERnM6IHtwZGZfY291bnR9KioiCiAgICAgICAgKQogICAgICAgIAogICAgICAgICMgU2VuZCB0aGUgSFRNTCBmaWxlCiAgICAgICAgY2FwdGlvbiA9ICgKICAgICAgICAgICAgZiIqKntwbGF0Zm9ybV9uYW1lfSBDb3Vyc2UgQ29udGVudCoqXG4iCiAgICAgICAgICAgIGYiKirwn46sIFZpZGVvczoge3ZpZGVvX2NvdW50fSB8IPCfk4QgUERGczoge3BkZl9jb3VudH0qKlxuXG4iCiAgICAgICAgICAgICIqKk9wZW4gdGhpcyBIVE1MIGZpbGUgaW4gYW55IHdlYiBicm93c2VyIHRvIGFjY2VzcyB5b3VyIGNvbnRlbnQuKioiCiAgICAgICAgKQogICAgICAgIGF3YWl0IG1lc3NhZ2UucmVwbHlfZG9jdW1lbnQoCiAgICAgICAgICAgIGRvY3VtZW50PW91dHB1dF9maWxlLAogICAgICAgICAgICAgICAgY2FwdGlvbj1jYXB0aW9uLAogICAgICAgICAgICBmaWxlX25hbWU9b3V0cHV0X2ZpbGUKICAgICAgICApCiAgICAgICAgCiAgICAgICAgIyBDbGVhbnVwCiAgICAgICAgdHJ5OgogICAgICAgICAgICBvcy5yZW1vdmUoZmlsZV9wYXRoKQogICAgICAgICAgICBvcy5yZW1vdmUob3V0cHV0X2ZpbGUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBpbiBwcm9jZXNzX3RleHRfY29udGVudDoge2V9IikKICAgICAgICBhd2FpdCBtZXNzYWdlLnJlcGx5X3RleHQoZiIqKkVycm9yOiB7c3RyKGUpfSoqIikg').decode('utf-8'))
